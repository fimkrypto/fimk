<div class="row" ng-controller="MasspayPluginController">
  <div ng-show="!initialized && !incomplete">
    <div class="col-md-12">Create a session to begin sending payments. Sessions protect you from data loss, a session enables you to continue a payment even after shutdown either incidentally or on purpose. Send multiple payments and visually track their status.<br><br>
    Payments are loaded from a file or entered manually, three syntaxes are supported CSV, JSON/dense and JSON/verbose. If you are sending payments to accounts without a public key please use the publish format for that account (account and public key separated by a : symbol).
    </div>
    <div class="col-md-8">
      <tabset style="padding-top: 20px">
        <tab heading="CSV"><code><pre>
FIM-XXXXX-YYYY-XXXX-ZZZZ,200.3001
FIM-OOOOI-YYYY-XXXX-ZZZZ,300.3001,true,encrypted message
FIM-XXXXX-YYYY-XXXX-ZZZZ,400.3001,false,plain message
FIM-OOOOI-YYYY-XXXX-ZZZZ,500.3001,true,message can contain commas (,)
FIM-XXXXX-YYYY-XXXX-ZZZZ,600.3001
FIM-OOOOI-YYYY-XXXX-ZZZZ:b9f5526cec224c66e3d4ea7b9d7aa14ead529157fe31beba66dce89bc2596e49,700.3001,false,publish address with public key
</pre></code></tab>        
        <tab heading="JSON (verbose)"><code><pre>
{
  "payments": [{
    "recipient": "FIM-XXXXX-YYYY-XXXX-ZZZZ",
    "amount": "200.3001",
    "message": "Hello I'm a message",
    "messageIsPublic": true
  }, {
    "recipient": "FIM-OOOOI-YYYY-XXXX-ZZZZ",
    "amount": "300.3001",
    "message": "Hello I'm also another message",
    "messageIsPublic": false
  }]
}
</pre></code></tab>
        <tab heading="JSON (dense)"><code><pre>
[
  ["FIM-XXXXX-YYYY-XXXX-ZZZZ","200.3001","Public message", true],
  ["FIM-OOOOI-YYYY-XXXX-ZZZZ","300.3001","Encrypted message"],
  ["FIM-XXXXX-YYYY-XXXX-ZZZZ","400.3001"],
  ["FIM-OOOOI-YYYY-XXXX-ZZZZ","500.3001"]
]
</pre></code></tab>
      </tabset>
    </div>
    <div class="col-md-4">
      <center>
        <h3>Click button to Start</h3>
        <br>
        <button class="btn btn-lg btn-primary" ng-click="start()">Start new Session</button>
      </center>
    </div>
  </div>
  <div ng-show="incomplete">
    <div class="row">
      <div class="col-md-12">
        <div class="well">It seems your previous session was not session to completion. Please select if you wish to continue with your previous session or if you would like start a new one.</div>
        <button class="btn btn-primary" ng-click="continuePreviousRun()">Continue Previous Session</button>
        <button class="btn btn-default" ng-click="startNewRun()">Start New Session</button>
      </div>
    </div>  
  </div>
  <div ng-show="initialized && !incomplete">  
<!--     <div class="row">
      <div class="col-md-12">
        <h4><small>Account</small>&nbsp;{{accountRS}}&nbsp;<span><small>File</small>&nbsp;{{fileName}}</span></h4>
      </div>
    </div>
    <br> -->
    <div ng-show="phase==CREATING">
      <div class="row">
        <div class="col-md-12">
          <div ng-show="zero_payments">
            <div class="alert alert-danger"><b>No payments selected. Click 'Start New Session' to retry.</b></div>
          </div>
          <div ng-show="!zero_payments">
            <h2>
              <i class="fa fa-pencil-square-o" ng-if="!isCreating"></i>
              <i class="fa fa-refresh fa-spin" ng-if="isCreating"></i>&nbsp;Prepare transactions</h2>
            Please carefully inspect the payments as they are displayed.<br>
            Payments are created and signed for which we need the secret phrase, payments are <b>not</b> broadcasted.
          </div>
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-success" ng-click="startCreatingTransactions()" 
            ng-disabled="isCreating || zero_payments">
            <i ng-if="isCreating" class="fa fa-refresh fa-spin"></i>&nbsp;Continue
          </button>
          <button class="btn btn-default" ng-click="stopCreatingTransactions()" ng-disabled="!isCreating">Stop</button>
          <button class="btn btn-default pull-right" ng-click="start()">Start New Session</button>
        </div>
      </div>
    </div>
    <div ng-show="phase==PRUNING">
      <div class="row">
        <div class="col-md-12">
          <h2><i class="fa fa-exclamation-triangle text-danger"></i>&nbsp;There are errors</h2>
          Not all transactions could be created. To see why a transaction could not be created click on the <b href class="text-danger">failed</b> link in the Created column.<br>
          Before you can continue please correct the failed transactions or delete them by clicking the <b href class="text-danger">delete</b> link. Click retry button to retry creating the transactions.
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-success" ng-click="startCreatingTransactions()" ng-disabled="isCreating">
            <i ng-if="isCreating" class="fa fa-refresh fa-spin"></i>&nbsp;Retry
          </button>
          <button class="btn btn-default" ng-click="stopCreatingTransactions()" ng-disabled="!isCreating">Stop</button>
          <button class="btn btn-default pull-right" ng-click="start()">Start New Session</button>
        </div>
      </div>
    </div>
    <div ng-show="phase==BROADCASTING">
      <div class="row">
        <div class="col-md-12">
          <h2>
            <i class="fa fa-rocket text-success" ng-if="!isBroadcasting"></i>
            <i class="fa fa-rocket text-success fa-spin" ng-if="isBroadcasting"></i>&nbsp;Broadcast to network</h2>
          The transactions are ready for broadcast.<br><br><b>Broadcasting transactions cannot be undone!</b><br><br>
          The confirmed column shows the status for each payment. Click the link in that column to check individual payment status.
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-danger" ng-click="startBroadcastingTransactions()" ng-disabled="isBroadcasting">
            <i ng-if="isBroadcasting" class="fa fa-refresh fa-spin"></i>&nbsp;<b>Broadcast</b></button>
          <button class="btn btn-default" ng-click="stopBroadcastingTransactions()" ng-disabled="!isBroadcasting">Stop</button>
          <button class="btn btn-default pull-right" ng-click="start()">Start New Session</button>
        </div>
      </div>
    </div>
    <div ng-show="phase==COMPLETE">
      <div class="row">
        <div class="col-md-12">
          <h2><i class="fa fa-refresh fa-spin text-success"></i>&nbsp;Broadcast complete</h2>
          <div>Please wait while we confirm your transactions are in the next block.<br>
          The confirmed column shows the status for each payment. Click the link in that column to check individual payment status.
          </div>
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-12">
          <div>
            <button class="btn btn-success" ng-click="forceCheckBlockchainStatus()">Refresh</button>
            <button class="btn btn-default" ng-click="hideretry=!hideretry">Retry</button>
            <button class="btn btn-default pull-right" ng-click="start()">Start New Session</button>
          </div>
          <div ng-init="hideretry=true" collapse="hideretry">
            <br>
            <b class="text-danger">WARNING! High risk of double payments!</b><br>Broadcasted transactions can take a while before they are included in a block.<br>If you are absolutely sure all remaining transactions have failed then click retry remaining button.<br><br><button class="btn btn-danger" ng-click="retryRemaining()"><b>DANGEROUS!</b>&nbsp;Retry</button><br>
          </div>
        </div>
      </div>
    </div>
    <div ng-show="phase==ALL_CONFIRMED">
      <div class="row">
        <div class="col-md-12">
          <h2><i class="fa fa-check text-success"></i>&nbsp;Congratulations all payments succeeded</h2>
          We have confirmed that all transactions are in the blockchain.<br>
          To be sure your payments are still in the blockchain even after a waiting period click the refresh button.
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-success" ng-click="forceCheckBlockchainStatus()">Refresh</button>
          <button class="btn btn-default pull-right" ng-click="start()">Start New Session</button>
        </div>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-md-12">
        <table ng-table="tableParams" class="table table-striped table-condensed table-hover">
          <tbody>
            <tr ng-repeat="t in $data">
              <td data-title="'Recipient'" header-class="text-left">
                <div>
                   <a href data-engine="{{t.engine_type}}" data-type="ACCOUNT" data-value="{{t.id_rs}}" class="txn txn-ACCOUNT" onclick="event.preventDefault(); if (angular.element(this).scope().onTransactionIdentifierClick) { angular.element(this).scope().onTransactionIdentifierClick(this) }">{{t.id_rs}}</a>&nbsp;<a href ng-click="inspect(t)"><i class="fa fa-question-circle"></i></a></div>
                <div ng-if="t.publicKey"><small>{{t.publicKey}}</small></div>
              <td>
              <td data-title="'Amount'" header-class="text-left"><strong>{{t.amountNXT}}</strong><td>
              <td data-title="'Message'" header-class="text-left">
                <i ng-show="t.message.length && !t.messageIsPublic" class="fa fa-lock"></i>
                <i ng-show="t.message.length && t.messageIsPublic" class="fa fa-unlock"></i>
                <span dd-text-collapse dd-text-collapse-max-length="30" dd-text-collapse-text="{{t.message}}"></span>
              <td>
              <td data-title="'Created'" header-class="text-left">
                <div>
                  <a href class="{{t.createdClass}}" ng-click="inspect(t.transactionResult)"><b>{{t.createdLabel}}</b></a>
                </div>
                <div ng-if="t.timestamp">{{t.timestamp}}</div>
              <td>
              <td data-title="'Broadcasted'" header-class="text-left">
                <div>
                  <a href class="{{t.broadcastedClass}}" ng-click="inspect(t.broadcastResult)"><b>{{t.broadcastedLabel}}</b></a>
                </div>
                <a href ng-click="broadcast(t)" ng-show="t.broadcasted == 1">re-broadcast</a>
              <td>
              <td data-title="'Confirmed'" header-class="text-left" nowrap>
                <i class="{{t.blockchainIcon}}"></i>&nbsp;<a href ng-click="status(t)">{{t.blockchainLabel}}</a>
              <td>
              <td header-class="text-left"><a href class="text-danger" ng-click="deletePayment(t)">delete</a><td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
